\documentclass[12pt,a4paper]{article}

\usepackage{fancyhdr}

\usepackage[colorlinks=true, linkcolor=blue, urlcolor=blue, citecolor=blue]{hyperref}
\usepackage[normalem]{ulem}
\newcommand{\ulink}[2]{\href{#1}{\uline{#2}}}

\theoremstyle{remark} % Remarks from amsthm
\newtheorem{remark}{Remark}[section] %

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%  	BEGIN DOCUMENT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\pagestyle{fancyplain}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Section 1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Building and installing MIRCO} \label{sec:intro}

As stated in the \textsc{README}, building MIRCO requires:

\begin{itemize}
	\item C++ compiler
	\item \ulink{www.cmake.org}{\textsc{CMake}} (version: $\ge$ 3.28)
	\item \ulink{https://github.com/kokkos/kokkos}{\textsc{Kokkos}} (version $\ge$ 3.7)s
	\item \ulink{https://github.com/kokkos/kokkos-kernels}{\textsc{Kokkos-Kernels}} (version $\ge$ 3.7)
\end{itemize}

While Kokkos and Kokkos-Kernels are required in general, they can also be used...library...target...


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Kokkos}

\textsc{Kokkos} is a programming model which enables on-node parallelism on different backends. The backends which are used depend on the Kokkos installation. For example, the following CMake command can be used to build Kokkos with OpenMP backend (see \ulink{https://kokkos.org/kokkos-core-wiki/get-started/building-from-source.html}{https://kokkos.org/kokkos-core-wiki/get-started/building-from-source.html} for details).
\begin{verbatim}
cmake \
  -DCMAKE_CXX_COMPILER=g++ \
  -DCMAKE_BUILD_TYPE=<Debug/Release> \
  -DCMAKE_CXX_STANDARD=20 \
  -DCMAKE_INSTALL_PREFIX=<kokkosInstallDir_openmp> \
  \
  -DKokkos_ENABLE_OPENMP=ON \
  \
<kokkosSourceDir>
\end{verbatim}

MIRCO is designed to support different "device" and "host" backends. The CMake command below, for example, can be used to build Kokkos such that it uses CUDA as the device backend (to run on an Nvidia GPU) and Serial as the host backend. The nvcc_wrapper is wrapper of the CUDA compiler, provided in the Kokkos source code.
\begin{verbatim}
cmake \
  -DCMAKE_CXX_COMPILER=<kokkosSourceDir>/bin/nvcc_wrapper \
  -DCMAKE_BUILD_TYPE=<Debug/Release> \
  -DCMAKE_CXX_STANDARD=20 \
  -DCMAKE_INSTALL_PREFIX=<kokkosInstallDir_serial+cuda> \
  \
  -DKokkos_ENABLE_SERIAL=ON \
  -DKokkos_ENABLE_CUDA=ON \
  \
<kokkosSourceDir>
\end{verbatim}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Kokkos-Kernels}

Kokkos-Kernels is a set of commonly used functions and utilities for Kokkos. MIRCO depends on the \textsc{KokkosLapack::gesv()} function, so a Kokkos-Kernels installation with Lapack enabled is also needed. Below are the two exemplary CMake commands which correspond to the shown Kokkos builds (OpenMP and Serial+CUDA).
\begin{verbatim}
cmake \
  -DCMAKE_CXX_COMPILER=g++ \
  -DCMAKE_BUILD_TYPE=<Debug/Release> \
  -DCMAKE_CXX_STANDARD=20 \
  -DCMAKE_INSTALL_PREFIX=<kokkosKernelsInstallDir_openmp> \
  \
  -DKokkos_ROOT=<kokkosInstallDir_openmp> \
  -DKokkosKernels_ENABLE_TPL_BLAS=ON \
  -DKokkosKernels_ENABLE_TPL_LAPACK=ON \
  \
<kokkosKernelsSourceDir>
\end{verbatim}

\begin{verbatim}
cmake \
  -DCMAKE_CXX_COMPILER=/home/oesterle/rd/kokkos_Base/kokkos/bin/nvcc_wrapper \
  -DCMAKE_BUILD_TYPE=<Debug/Release> \
  -DCMAKE_CXX_STANDARD=20 \
  -DCMAKE_INSTALL_PREFIX=<kokkosKernelsInstallDir_openmp> \
  \
  -DKokkos_ROOT=<kokkosInstallDir_openmp> \
  -DKokkosKernels_ENABLE_TPL_BLAS=ON \
  -DKokkosKernels_ENABLE_TPL_LAPACK=ON \
  -DKokkosKernels_ENABLE_TPL_CUSOLVER=ON \
  \
<kokkosKernelsSourceDir>
\end{verbatim}

It can be seen that Kokkos-Kernels requires the third party libraries BLAS and LAPACK, as well as CuSolver if CUDA is enabled.

Refer to \ulink{https://kokkos.org/kokkos-core-wiki/get-started/building-from-source.html}{https://kokkos.org/kokkos-core-wiki/get-started/building-from-source.html} on how to build Kokkos and Kokkos-Kernels for other backends like HIP (for AMD GPUs) and SYCL (for Intel GPUs).

\begin{remark}
  In case
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Building MIRCO}


































\begin{verbatim}
#serial:
cd debug_develop_serial/build

cmake \
  -DCMAKE_INSTALL_PREFIX=../install \
  \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_CXX_STANDARD=20 \
  \
  -DKokkos_ENABLE_SERIAL=ON \
  \
  -DCMAKE_CXX_COMPILER=g++ \
../../kokkos

##kokkos-kernels:

cmake \
  -DKokkos_ROOT=/home/oesterle/rd/kokkos_Base/debug_develop_serial/install \
  -DKokkosKernels_ENABLE_TPL_BLAS=ON \
  -DKokkosKernels_ENABLE_TPL_LAPACK=ON \
  \
  -DCMAKE_INSTALL_PREFIX=../install \
  \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_CXX_STANDARD=20 \
  \
  -DKokkos_ENABLE_SERIAL=ON \
  \
  -DCMAKE_CXX_COMPILER=g++ \
  \
../../kokkos-kernels


#openmp:
cd debug_develop_openmp/build

cmake \
  -DCMAKE_INSTALL_PREFIX=../install \
  \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_CXX_STANDARD=20 \
  \
  -DKokkos_ENABLE_OPENMP=ON \
  \
  -DCMAKE_CXX_COMPILER=g++ \
  \
  -DKokkos_ENABLE_DEBUG=ON \
  -DKokkos_ENABLE_DEBUG_PRINT=ON \
../../kokkos

##kokkos-kernels:

cmake \
  -DKokkos_ROOT=/home/oesterle/rd/kokkos_Base/debug_develop_openmp/install \
  -DKokkosKernels_ENABLE_TPL_BLAS=ON \
  -DKokkosKernels_ENABLE_TPL_LAPACK=ON \
  \
  -DCMAKE_INSTALL_PREFIX=../install \
  \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_CXX_STANDARD=20 \
  \
  -DKokkos_ENABLE_OPENMP=ON \
  \
  -DCMAKE_CXX_COMPILER=g++ \
../../kokkos-kernels

"-DBLAS_LIBRARIES=/usr/lib/x86_64-linux-gnu/libblas.so \
  -DLAPACK_LIBRARIES=/usr/lib/x86_64-linux-gnu/liblapack.so \"?


#CUDA:
cd debug_develop_cuda/build

cmake \
  -DCMAKE_INSTALL_PREFIX=../installRel \
  \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DCMAKE_BUILD_TYPE=Release \
  -DCMAKE_CXX_STANDARD=20 \
  \
  -DKokkos_ENABLE_SERIAL=ON \
  -DKokkos_ENABLE_CUDA=ON \
  \
  -DCMAKE_CXX_COMPILER=/home/oesterle/rd/kokkos_Base/kokkos/bin/nvcc_wrapper \
  -DKokkos_ARCH_ADA100=ON \
../../kokkos

"-DKokkos_ENABLE_CUDA_LAMBDA=ON \"?

  -DKOKKOS_HOST_COMPILER=clang++ \


##kokkos-kernels:
cmake \
  -DKokkos_ROOT=/home/oesterle/rd/kokkos_Base/debug_develop_cuda/installRel \
  -DKokkosKernels_ENABLE_TPL_BLAS=ON \
  -DKokkosKernels_ENABLE_TPL_LAPACK=ON \
  -DKokkosKernels_ENABLE_TPL_CUSOLVER=ON \
  \
  -DCMAKE_INSTALL_PREFIX=../installRel \
  \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DCMAKE_BUILD_TYPE=Release \
  -DCMAKE_CXX_STANDARD=20 \
  \
  -DKokkos_ENABLE_SERIAL=ON \
  -DKokkos_ENABLE_CUDA=ON \
  \
  -DCMAKE_CXX_COMPILER=/home/oesterle/rd/kokkos_Base/kokkos/bin/nvcc_wrapper \
  -DKokkos_ARCH_ADA100=ON \
../../kokkos-kernels


  -DKokkosKernels_INST_FLOAT=ON \

  -DKokkosKernels_ENABLE_TPL_MAGMA=ON \
  -DKokkosKernels_MAGMA_ROOT=/home/oesterle/rd/tpl/magma_base/install \

  -DKokkosKernels_ENABLE_TPL_CUSOLVER=OFF \
  -DKokkosKernels_ENABLE_TPL_CUBLAS=OFF \
  -DKokkosKernels_ENABLE_TPL_CUSPARSE=OFF \
  -DKokkosKernels_NO_DEFAULT_CUDA_TPLS=ON \






OR, INSTEAD OF `-DKokkosKernels_MAGMA_ROOT=/home/oesterle/rd/tpl/magma_base/install`, YOU CAN export MAGMA_DIR=/home/oesterle/rd/tpl/magma_base/install INTO THE ENV



  -D MAGMA_INCLUDE_DIRS="/home/oesterle/rd/tpl/magma_base/install/include" \
  -D MAGMA_LIBRARIES="/home/oesterle/rd/tpl/magma_base/install/lib/libmagma.a" \

  -DKokkosKernels_MAGMA_ROOT=/home/oesterle/rd/tpl/magma_base/install/lib/cmake/magma \




"-DBLAS_LIBRARIES=/usr/lib/x86_64-linux-gnu/libblas.so \
  -DLAPACK_LIBRARIES=/usr/lib/x86_64-linux-gnu/liblapack.so \"?


#openmp+CUDA:
cd debug_develop_openmp+cuda/build

cmake \
  -DCMAKE_INSTALL_PREFIX=../install \
  \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_CXX_STANDARD=20 \
  \
  -DKokkos_ENABLE_SERIAL=ON \
  -DKokkos_ENABLE_OPENMP=ON \
  -DKokkos_ENABLE_CUDA=ON \
  \
  -DCMAKE_CXX_COMPILER=/home/oesterle/rd/kokkos_Base/kokkos/bin/nvcc_wrapper \
  -DKokkos_ARCH_ADA100=ON \
../../kokkos

"-DKokkos_ENABLE_CUDA_LAMBDA=ON \"?

##kokkos-kernels:

cmake \
  -DKokkos_ROOT=/home/oesterle/rd/kokkos_Base/debug_develop_openmp+cuda/install \
  -DKokkosKernels_ENABLE_TPL_BLAS=ON \
  -DKokkosKernels_ENABLE_TPL_LAPACK=ON \
  \
  -DCMAKE_INSTALL_PREFIX=../install \
  \
  -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
  -DCMAKE_BUILD_TYPE=Debug \
  -DCMAKE_CXX_STANDARD=20 \
  \
  -DKokkos_ENABLE_SERIAL=ON \
  -DKokkos_ENABLE_OPENMP=ON \
  -DKokkos_ENABLE_CUDA=ON \
  \
  -DCMAKE_CXX_COMPILER=/home/oesterle/rd/kokkos_Base/kokkos/bin/nvcc_wrapper \
  -DKokkos_ARCH_ADA100=ON \
../../kokkos-kernels


"-DBLAS_LIBRARIES=/usr/lib/x86_64-linux-gnu/libblas.so \
  -DLAPACK_LIBRARIES=/usr/lib/x86_64-linux-gnu/liblapack.so \"?
\end{verbatim}

\end{document}
