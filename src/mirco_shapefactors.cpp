#include "mirco_shapefactors.h"

#include <stdexcept>

namespace {
  // Shape factors (See section 3.3 of https://doi.org/10.1007/s00466-019-01791-3)
  // These are the shape factors to calculate the elastic compliance correction of the micro-scale
  // contact constitutive law for various N (number of elements/cells on the side length). These
  // were calculated with the flatMirco utility, which solves a flat indentor problem.
  
  // The following pressure based constants were computed with PressureGreenFunFlag=true, which uses
  // the pressure based Green function described in Pohrt and Li (2014).
  constexpr double shape_factors_pressure[] = {
-1,
1.1221997046783601,
1.0068605251532488,
0.9613892379176020,
0.9385553774805636,
0.9247153424324348,
0.9154315222403189,
0.9087685392496164,
0.9037519877715218,
0.8998375318806960,
0.8966971707662920,
0.8941214388008707,
0.8919702710377438,
0.8901464435834803,
0.8885803476015525,
0.8872208283196538,
0.8860294454171725,
0.8849767510419420,
0.8840398035738944,
0.8832004634308483,
0.8824441981346328,
0.8817592274578138,
0.8811359008070113,
0.8805662363985263,
0.8800435751941630,
0.8795623175713734,
0.8791177205270475,
0.8787057397731858,
0.8783229055386896,
0.8779662239682807,
0.8776330981656899,
0.8773212644600169,
0.8770287405762019,
0.8767537831928618,
0.8764948529612128,
0.8762505854977565,
0.8760197671930579,
0.8758013149284216,
0.8755942589829997,
0.8753977285605654,
0.8752109394790319,
0.8750331836546568,
0.8748638200828360,
0.8747022670726458,
0.8745479955362805,
0.8744005231699363,
0.8742594093907941,
0.8741242509179724,
0.8739946779037806,
0.8738703505369385,
0.8737509560518952,
0.8736362060886783,
0.8735258343562692,
0.8734195945595118,
0.8733172585555273,
0.8732186147105025,
0.8731234664318939,
0.8730316308545875,
0.8729429376624437,
0.8728572280293107,
0.8727743536654636,
0.8726941759576233,
0.8726165651917530,
0.8725413998497363,
0.8724685659716703,
0.8723979565768788,
0.8723294711373156,
0.8722630150979972,
0.8721984994395870,
0.8721358402788736,
0.8720749585033892,
0.8720157794368250,
0.8719582325321117,
0.8719022510898027,
0.8718477719991138,
0.8717947354996006,
0.8717430849616338,
0.8716927666839049,
0.8716437297064199,
0.8715959256377248,
0.8715493084949282,
0.8715038345556950,
0.8714594622208272,
0.8714161518869703,
0.8713738658281966,
0.8713325680860236,
0.8712922243670302,
0.8712528019475250,
0.8712142695847315,
0.8711765974338832,
0.8711397569708160,
0.8711037209197295,
0.8710684631856029,
0.8710339587908758,
0.8710001838163289,
0.8709671153454956,
0.8709347314127122,
0.8709030109542131,
0.8708719337623509,
0.8708414804424734,
0.8708116323724222,
0.8707823716644716,
0.8707536811294047,
0.8707255442427748,
0.8706979451130281,
0.8706708684514842,
0.8706442995440027,
0.8706182242242404,
0.8705926288483654,
0.8705675002712058,
0.8705428258235640,
0.8705185932910390,
0.8704947908935752,
0.8704714072665267,
0.8704484314423032,
0.8704258528332744,
0.8704036612155031,
0.8703818467131120,
0.8703603997836817,
0.8703393112042844,
0.8703185720581880,
0.8702981737222848,
0.8702781078550457,
0.8702583663851549,
0.8702389415006424,
0.8702198256385461,
0.8702010114750538,
0.8701824919161364,
0.8701642600885777,
0.8701463093314764,
0.8701286331880771,
0.8701112253980423,
0.8700940798899739,
0.8700771907744301,
0.8700605523370234,
0.8700441590321293,
0.8700280054765350,
0.8700120864436449,
0.8699963968577871,
0.8699809317888084,
0.8699656864468270,
0.8699506561774316,
0.8699358364567530,
0.8699212228870411,
0.8699068111922198,
0.8698925972137684,
0.8698785769066413,
0.8698647463354724,
0.8698511016708736,
0.8698376391859013,
0.8698243552525514,
0.8698112463386752,
0.8697983090047070,
0.8697855399006177,
0.8697729357631369,
0.8697604934129347,
0.8697482097518127,
0.8697360817602883,
0.8697241064950577,
0.8697122810865268,
0.8697006027366802,
0.8696890687166938,
0.8696776763649486,
0.8696664230848308,
0.8696553063428945,
0.8696443236668848,
0.8696334726438905,
0.8696227509186220,
0.8696121561916337,
0.8696016862177500,
0.8695913388044076,
0.8695811118102050,
0.8695710031432379,
0.8695610107600013,
0.8695511326636374,
0.8695413669028617,
0.8695317115705792,
0.8695221648025528,
0.8695127247764576,
0.8695033897104039,
0.8694941578620147,
0.8694850275273235,
0.8694759970396524,
0.8694670647686292,
0.8694582291192032,
0.8694494885307255,
0.8694408414759697,
0.8694322864602609,
0.8694238220206332,
0.8694154467249720,
0.8694071591712454,
0.8693989579865983,
0.8693908418268446,
0.8693828093753534,
0.8693748593427122,
0.8693669904658041,
0.8693592015072237,
0.8693514912546113,
0.8693438585199933,
0.8693363021391944,
0.8693288209713255,
0.8693214138980144,
0.8693140798230478,
0.8693068176716884,
0.8692996263902630,
0.8692925049455269,
0.8692854523242661,
0.8692784675327792,
0.8692715495964286,
0.8692646975591299,
0.8692579104829830,
0.8692511874478330,
0.8692445275507553,
0.8692379299058092,
0.8692313936435090,
0.8692249179105097,
0.8692185018692348,
0.8692121446974737,
0.8692058455881135,
0.8691996037485643,
0.8691934184008729,
0.8691872887808946,
0.8691812141383327,
0.8691751937361829,
0.8691692268507010,
0.8691633127709649,
0.8691574507984677,
0.8691516402470268,
0.8691458804425604,
0.8691401707225948,
0.8691345104361798,
0.8691288989436771,
0.8691233356163326,
0.8691178198361962,
0.8691123509959132,
0.8691069284983202,
0.8691015517564095,
0.8690962201930380,
0.8690909332407660,
0.8690856903415636,
0.8690804909467115,
0.8690753345165723,
0.8690702205203537,
0.8690651484360690,
0.8690601177501756,
0.8690551279574785,
0.8690501785610905,
0.8690452690720187,
0.8690403990091906,
0.8690355678992415,
0.8690307752763430,
0.8690260206820768,
0.8690213036652844,
0.8690166237819122,
0.8690119805948778,
0.8690073736739258,
0.8690028025955291,
0.8689982669426977,
0.8689937663049341,
0.8689893002780049,
0.8689848684639349,
0.8689804704707877,
0.8689761059126492,
0.8689717744093044,
0.8689674755865412,
0.8689632090755518,
0.8689589745131775,
0.8689547715415691,
0.8689505998083539,
0.8689464589663463,
0.8689423486734169,
0.8689382685923429,
0.8689342183912990,
0.8689301977428475,
0.8689262063245560,
0.8689222438185514,
0.8689183099116433,
0.8689144042951042,
0.8689105266646669,
0.8689066767203559,
0.8689028541665230,
0.8688990587117029,
0.8688952900685588,
0.8688915479538014,
0.8688878320880424,
0.8688841421959901,
0.8688804780059999,
0.8688768392502909,
0.8688732256648110,
0.8688696369890363,
0.8688660729662815,
0.8688625333429942,
0.8688590178694573,
0.8688555262991561,
0.8688520583889556,
0.8688486138990151,
0.8688451925927237,
0.8688417942366444,
0.8688384186004703,
0.8688350654569872,
0.8688317345819185,
0.8688284257541729,
0.8688251387552876,
0.8688218733698870,
0.8688186293853191,
0.8688154065917477,
0.8688122047820807,
0.8688090237519289,
0.8688058632994639,
0.8688027232256764,
0.8687996033338000,
0.8687965034298341,
0.8687934233222162,
0.8687903628217093,
0.8687873217417165,
0.8687842998976991,
0.8687812971076894,
0.8687783131918636,
0.8687753479727728,
0.8687724012751177,
0.8687694729257903
};
  constexpr int shape_factors_pressure_length = sizeof(shape_factors_pressure) / sizeof(shape_factors_pressure[0]);

  // The following force based constants were computed with PressureGreenFunFlag=false (cf. Table 1 of Bonari et al. (2020) (https://doi.org/10.1007/s00466-019-01791-3) for shape factors in terms of resolution).
  constexpr double shape_factors_force[] = {
-1,
0.6366197723675814,
0.7666699475984320,
0.7789585415133602,
0.7961148796273941,
0.8055133886663757,
0.8127671025256030,
0.8182212743711261,
0.8225746236818395,
0.8261268713954162,
0.8290942114643841,
0.8316154836131895,
0.8337888231068056,
0.8356846634614012,
0.8373552576125837,
0.8388402081677774,
0.8401701442066313,
0.8413691581105132,
0.8424564856686131,
0.8434476875988886,
0.8443554991640697,
0.8451904522744961,
0.8459613386543430,
0.8466755598119302,
0.8473393950447318,
0.8479582091819997,
0.8485366154076104,
0.8490786041754905,
0.8495876462335299,
0.8500667756660438,
0.8505186573640674,
0.8509456422492288,
0.8513498127851887,
0.8517330207256517,
0.8520969186112199,
0.8524429861981521,
0.8527725527516871,
0.8530868159445046,
0.8533868579523674,
0.8536736592232858,
0.8539481103057767,
0.8542110220500827,
0.8544631344392536,
0.8547051242614272,
0.8549376117980163,
0.8551611666729038,
0.8553763129836737,
0.8555835338162737,
0.8557832752283748,
0.8559759497734233,
0.8561619396263829,
0.8563415993630449,
0.8565152584371540,
0.8566832233932402,
0.8568457798476746,
0.8570031942659552,
0.8571557155604181,
0.8573035765293110,
0.8574469951554204,
0.8575861757800831,
0.8577213101663957,
0.8578525784637072,
0.8579801500839872,
0.8581041844993790,
0.8582248319691329,
0.8583422342031545,
0.8584565249685565,
0.8585678306448844,
0.8586762707330372,
0.8587819583223574,
0.8588850005198675,
0.8589854988452061,
0.8590835495944390,
0.8591792441755849,
0.8592726694184045,
0.8593639078607394,
0.8594530380134580,
0.8595401346058623,
0.8596252688132241,
0.8597085084679600,
0.8597899182558099,
0.8598695598982516,
0.8599474923222772,
0.8600237718185371,
0.8600984521887903,
0.8601715848834820,
0.8602432191302349,
0.8603134020539349,
0.8603821787890578,
0.8604495925848173,
0.8605156849036653,
0.8605804955136338,
0.8606440625749662,
0.8607064227214443,
0.8607676111367959,
0.8608276616265186,
0.8608866066854460,
0.8609444775613513,
0.8610013043148486,
0.8610571158758532,
0.8611119400968251,
0.8611658038030077,
0.8612187328398614,
0.8612707521178755,
0.8613218856549215,
0.8613721566163075,
0.8614215873526855,
0.8614701994359272,
0.8615180136931193,
0.8615650502387702,
0.8616113285053553,
0.8616568672722853,
0.8617016846934070,
0.8617457983231103,
0.8617892251411321,
0.8618319815761285,
0.8618740835280874,
0.8619155463896501,
0.8619563850663980,
0.8619966139961722,
0.8620362471674669,
0.8620752981369624,
0.8621137800462316,
0.8621517056376766,
0.8621890872697267,
0.8622259369313450,
0.8622622662558769,
0.8622980865342763,
0.8623334087277400,
0.8623682434797848,
0.8624026011277925,
0.8624364917140522,
0.8624699249963241,
0.8625029104579499,
0.8625354573175312,
0.8625675745382014,
0.8625992708365019,
0.8626305546908942,
0.8626614343499157,
0.8626919178400013,
0.8627220129729872,
0.8627517273533051,
0.8627810683848944,
0.8628100432778316,
0.8628386590546989,
0.8628669225567036,
0.8628948404495524,
0.8629224192291035,
0.8629496652267957,
0.8629765846148715,
0.8630031834113979,
0.8630294674851023,
0.8630554425600212,
0.8630811142199767,
0.8631064879128890,
0.8631315689549250,
0.8631563625345007,
0.8631808737161303,
0.8632051074441430,
0.8632290685462630,
0.8632527617370590,
0.8632761916212744,
0.8632993626970408,
0.8633222793589725,
0.8633449459011610,
0.8633673665200586,
0.8633895453172679,
0.8634114863022317,
0.8634331933948330,
0.8634546704279070,
0.8634759211496676,
0.8634969492260542,
0.8635177582429966,
0.8635383517086114,
0.8635587330553187,
0.8635789056418952,
0.8635988727554561,
0.8636186376133780,
0.8636382033651537,
0.8636575730941929,
0.8636767498195632,
0.8636957364976744,
0.8637145360239136,
0.8637331512342267,
0.8637515849066502,
0.8637698397627963,
0.8637879184692936,
0.8638058236391805,
0.8638235578332585,
0.8638411235614043,
0.8638585232838408,
0.8638757594123718,
0.8638928343115788,
0.8639097502999816,
0.8639265096511665,
0.8639431145948788,
0.8639595673180863,
0.8639758699660086,
0.8639920246431202,
0.8640080334141197,
0.8640238983048776,
0.8640396213033517,
0.8640552043604773,
0.8640706493910361,
0.8640859582744969,
0.8641011328558319,
0.8641161749463151,
0.8641310863242933,
0.8641458687359401,
0.8641605238959846,
0.8641750534884257,
0.8641894591672217,
0.8642037425569652,
0.8642179052535373,
0.8642319488247457,
0.8642458748109449,
0.8642596847256396,
0.8642733800560747,
0.8642869622638051,
0.8643004327852566,
0.8643137930322645,
0.8643270443926074,
0.8643401882305184,
0.8643532258871899,
0.8643661586812594,
0.8643789879092900,
0.8643917148462318,
0.8644043407458760,
0.8644168668412958,
0.8644292943452766,
0.8644416244507360,
0.8644538583311315,
0.8644659971408616,
0.8644780420156528,
0.8644899940729400,
0.8645018544122375,
0.8645136241154979,
0.8645253042474678,
0.8645368958560281,
0.8645483999725339,
0.8645598176121382,
0.8645711497741146,
0.8645823974421669,
0.8645935615847380,
0.8646046431553018,
0.8646156430926590,
0.8646265623212190,
0.8646374017512770,
0.8646481622792852,
0.8646588447881172,
0.8646694501473267,
0.8646799792134001,
0.8646904328300038,
0.8647008118282240,
0.8647111170268040,
0.8647213492323739,
0.8647315092396761,
0.8647415978317847,
0.8647516157803233,
0.8647615638456714,
0.8647714427771751,
0.8647812533133442,
0.8647909961820518,
0.8648006721007258,
0.8648102817765376,
0.8648198259065868,
0.8648293051780809,
0.8648387202685111,
0.8648480718458278,
0.8648573605686065,
0.8648665870862137,
0.8648757520389704,
0.8648848560583098,
0.8648938997669310,
0.8649028837789532,
0.8649118087000621,
0.8649206751276578,
0.8649294836509948,
0.8649382348513230,
0.8649469293020258,
0.8649555675687500,
0.8649641502095420,
0.8649726777749716,
0.8649811508082611,
0.8649895698454078,
0.8649979354153036,
0.8650062480398548,
0.8650145082340980,
0.8650227165063130,
0.8650308733581347,
0.8650389792846626,
0.8650470347745672,
0.8650550403101964,
0.8650629963676757,
0.8650709034170119,
0.8650787619221906,
0.8650865723412726,
0.8650943351264918,
0.8651020507243438,
0.8651097195756821,
0.8651173421158050,
0.8651249187745450,
0.8651324499763526,
0.8651399361403853,
0.8651473776805867,
0.8651547750057695,
0.8651621285196965,
0.8651694386211568,
0.8651767057040451,
0.8651839301574362,
0.8651911123656585,
0.8651982527083676,
0.8652053515606183,
0.8652124092929340,
0.8652194262713742,
0.8652264028576055,
0.8652333394089652,
0.8652402362785261,
0.8652470938151633,
0.8652539123636140,
0.8652606922645413
};
  constexpr int shape_factors_force_length = sizeof(shape_factors_force) / sizeof(shape_factors_force[0]);
} // namespace

double MIRCO::getShapeFactor(int N, bool PressureGreenFunFlag) {
  if(N >= (PressureGreenFunFlag?shape_factors_pressure_length:shape_factors_pressure_length)) {
    throw std::runtime_error("No shape factor available for N="+std::to_string(N)+" and PressureGreenFunFlag="+(PressureGreenFunFlag?"true":"false"));
    return -1;
  }
  // else
  if(PressureGreenFunFlag)
    return shape_factors_pressure[N];
  // else
  return shape_factors_force[N];
}
